<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Resizeable Scatter plot</title>

    <link rel="stylesheet" href="scatterplot.css">

    <script src="../resources/d3.min.js"></script>
    <script src="../resources/d3-legend.js"></script>
    <script src="scatterplot.js"></script>

</head>
<body>

<form>
    Width: <input id="w" type="text" value="400">&nbsp;&nbsp;
    Height: <input id="h" type="text" value="350">&nbsp;&nbsp;
    <button type="button" class="resize">Resize!</button>
    <p/>
    <button type="button" class="change">Change Data</button>
    <p/>
    Mark: <input id="m" type="text" value='["a","b","c"]'>&nbsp;&nbsp;<button type="button" class="mark">Mark Data</button>
</form>
<hr/>
<div id="scatterplot1">
    <div id="container" class="svg-container" style="width:400px; height:350px"></div>
</div>
<br>
<div id="selection"></div>

<script>
    // Below, we will now "use" the chart by submitting data
  // and configuration to it as an encapsulated component.
  // Notice that we have never used the "new" keyword.
  //
  // This is a separation of concerns. We can be sure
  // that we haven't hard-coded and essential values
  // or unnecessarily hidden events from our future selves
  // who may need to use the chart again.

  var dataSet1 = [
    {"uuid":"a", "x": 100, "y": 200, "color": 1, "size": 3},
    {"uuid":"b", "x": 120, "y": 220, "color": 2, "size": 4},
    {"uuid":"c", "x": 159, "y": 280, "color": 5, "size": 6},
    {"uuid":"d", "x": 110, "y": 209, "color": 1.4, "size": 7},
    {"uuid":"e", "x": 134, "y": 218, "color": 7.2, "size": 8},
    {"uuid":"f", "x": 139, "y": 243, "color": 3.4, "size": 30},
    {"uuid":"g", "x": 105, "y": 237, "color": 6.4, "size": 3},
    {"uuid":"h", "x": 127, "y": 202, "color": 2.5, "size": 4},
    {"uuid":"i", "x": 132, "y": 239, "color": 6.3, "size": 6},
    {"uuid":"j", "x": 181, "y": 289, "color": 1.4, "size": 7},
    {"uuid":"k", "x": 203, "y": 278, "color": 7.9, "size": 8}
  ];

  var dataSet2 = [
    {"uuid":"a", "x": 180, "y": 200, "color": 1, "size": 3},
    {"uuid":"bu", "x": 520, "y": 120, "color": 2, "size": 4},
    {"uuid":"c", "x": 159, "y": 380, "color": 5, "size": 6},
    {"uuid":"d", "x": 210, "y": 289, "color": 1.4, "size": 7},
    {"uuid":"ed", "x": 134, "y": 218, "color": 7.2, "size": 18},
    {"uuid":"f", "x": 239, "y": 243, "color": 3.4, "size": 20},
    {"uuid":"g", "x": 165, "y": 237, "color": 6.4, "size": 3},
    {"uuid":"h", "x": 227, "y": 402, "color": 2.5, "size": 24},
    {"uuid":"if", "x": 132, "y": 239, "color": 6.3, "size": 6},
    {"uuid":"j", "x": 181, "y": 189, "color": 1.4, "size": 7},
    {"uuid":"k", "x": 203, "y": 228, "color": 7.9, "size": 3},
    {"uuid":"ac", "x": 100, "y": 200, "color": 1, "size": 5},
    {"uuid":"bf", "x": 20, "y": 220, "color": 2, "size": 4},
    {"uuid":"ce", "x": 199, "y": 280, "color": 5, "size": 1},
    {"uuid":"ds", "x": 110, "y": 209, "color": 1.4, "size": 7},
    {"uuid":"ew", "x": 164, "y": 218, "color": 7.2, "size": 8},
    {"uuid":"fg", "x": 239, "y": 143, "color": 3.4, "size": 30},
    {"uuid":"gg", "x": 135, "y": 237, "color": 6.4, "size": 3},
    {"uuid":"hd", "x": 187, "y": 102, "color": 2.5, "size": 14},
    {"uuid":"id", "x": 122, "y": 239, "color": 6.3, "size": 9},
    {"uuid":"jh", "x": 189, "y": 189, "color": 1.4, "size": 3},
  ];

    function selectionHandler(selected, selectedAndMarked) {
        var text = "Selection: ";

        if (selected == null) {
            text += "None";
        } else if (selected.length == 0) {
            text += "Empty";
        } else {
            text += selected.join(",");
        }
        text += "<br>Selected and marked: ";

        if (selectedAndMarked == null || selectedAndMarked.length == 0) {
            text += "None";
        } else {
            text += selectedAndMarked.join(",");
        }
        //console.log(text);
        document.getElementById("selection").innerHTML = text;
    }

  // Here we're selecting the containing element.
  var selection = d3.selectAll('#scatterplot1 .svg-container');


  myScatterplot = createScatterPlot(selection, 'X Axis', 'Y Axis', 'steelblue-brown', true, selectionHandler, dataSet1)

  resize = function() {

    var w = document.getElementById("w").value;
    var h = document.getElementById("h").value;

    selection.style("width", w+'px');
    selection.style("height", h+'px');

    resizeScatterPlot(selection);
  };

  var nextDataSet = dataSet2;

  changeData = function() {
    d3.select('#scatterplot1 .svg-container')
      .datum(nextDataSet)
      .call(myScatterplot);

    nextDataSet = (nextDataSet === dataSet2) ? dataSet1 : dataSet2;

    d3.select('button.change')
    .text('Load New Data');
  };

  markData = function() {

    var json = document.getElementById("m").value;
    var marks = JSON.parse(json);

    markScatterPlot(selection, marks);
  }


  d3.select('button.resize').on('click', resize);
  d3.select('button.change').on('click', changeData);
  d3.select('button.mark').on('click', markData);
</script>
</body>
</html>